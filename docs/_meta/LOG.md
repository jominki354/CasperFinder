# LOG
## [2026-02-10] Planning & Design Phase
- 프로젝트 초기화 및 메타 문서 생성 완료.
- 기획전 유형별(E, D, R) 서브 메뉴 및 필터 동작 분석.
- MVP 계획서 작성 (Chrome Extension -> Python 앱 전환).

## [2026-02-10] Implementation Phase
- 실제 API 엔드포인트 발견: `/gw/wp/product/v2/product/exhibition/cars/{exhbNo}`.
- config.json + main.py 구현, API 테스트 성공.

## [2026-02-10] GUI + Modularization
- tkinter GUI 추가: 로그/히스토리/설정 탭.
- 코드 모듈화: 8개 모듈 분리 (core/ + ui/).

## [2026-02-10] PyQt-Fluent-Widgets 전환
- tkinter → PyQt5 + PyQt-Fluent-Widgets 전환.
- Windows 11 Fluent Design 적용 (다크모드 자동, FluentIcon).
- pystray → QSystemTrayIcon 전환 (Pillow 의존성 제거).
- threading → QThread + pyqtSignal 전환 (스레드 안전).
- FluentWindow + NavigationInterface 기반 사이드바 네비게이션.
- TableWidget으로 알림 히스토리 테이블 업그레이드.
- CardWidget으로 설정 UI 카드 스타일 적용.
- InfoBar로 설정 저장 피드백 표시.

## [2026-02-10] 데이터 수집 및 분석
- 2026 캐스퍼 일렉트릭 트림/옵션/색상 사양 문서 작성 (`docs/CASPER_ELECTRIC_2026.md`).
- 외장 14종 + 내장 4종 색상 칩 이미지 다운로드 → `assets/colors/`.
- 기획전 배송 지역 / 보조금 지역 코드 전수 추출 (Vue 컴포넌트 분석).
  - 배송 지역: 17개 시/도 + 200여 개 시/군/구 코드.
  - 보조금 지역: 18개 시/도(환경공단 포함) + 200여 개 시/군 코드.
- `constants/regions.json` 생성 (전국 지역 코드 매핑).
- `docs/REGIONS.md` 분석 문서 작성 (API 파라미터, 쿠키 구조, 구현 가이드).

## [2026-02-10] UI 리팩토링 (화이트 테마 + 모듈화)
- 다크모드 → 화이트(라이트) 테마 전환.
- UI 모듈 구조화:
  - `ui/theme.py`: 색상/크기/폰트 상수 분리.
  - `ui/pages/alert_page.py`: 차량알림 페이지 (카드 리스트).
  - `ui/pages/filter_page.py`: 조건설정 페이지 (placeholder).
  - `ui/pages/settings_page.py`: 설정 페이지.
  - `ui/widgets/vehicle_card.py`: 차량 카드 위젯 (색상 칩 + 옵션 + 계약 버튼).
  - `ui/app.py`: 메인 윈도우 (FluentWindow, 페이지 조합만 담당).
- 좌측 네비게이션 항상 펼침 (접힘 방지).
- `setCustomBackgroundColor()` API 사용으로 FluentWindow 배경 제어.

## [2026-02-10] Flet UI 전환
- PyQt-Fluent-Widgets → **Flet** 프레임워크 전환.
- `ui/app_flet.py`: 전체 UI (네비게이션 + 3탭) 단일 파일 구현.
- `core/poller_flet.py`: PyQt 의존성 제거, 순수 threading + 콜백 방식 폴링 엔진.
- 화이트 배경 + 진한 회색(`#3B3B3B`) 시그니처 컬러.
- 좌측 네비게이션 항상 펼침 (200px 고정).
- 차량 카드: 색상 칩 패널 + 모델/트림/가격/옵션 + 계약 버튼.

## [2026-02-10] Discord 다크모드 테마
- 화이트 → **Discord 다크모드** 전환.
- `theme.py`: Discord 색상 체계 적용 (BG 4단계 + Blurple `#5865F2`).
- 네비게이션 호버/활성 효과 추가.
- 카드/버튼/다이얼로그 전면 다크 스타일 적용.

## [2026-02-10] 시스템 트레이 통합
- `ui/tray.py`: pystray 기반 트레이 매니저 (PyQt 의존 제거).
- 닫기/최소화 시 트레이로 숨김 (`page.window.prevent_close`).
- 첫 숨김 시 "트레이로 실행중입니다!" 말풍선 알림.
- 트레이 더블클릭 → 창 복원, 우클릭 → 열기/종료 메뉴.

## [2026-02-10] CustomTkinter 전환
- Flet → **CustomTkinter** 전환 (Flet의 세션GC 문제로 트레이 불가).
- Flet UI 파일 전부 삭제 (`app_flet.py`, `poller_flet.py`, `pages/`, `widgets/`).
- `ui/app.py`: CustomTkinter 단일 파일 전체 UI (네비게이션 + 3탭).
- `core/poller.py`: PyQt 의존 제거, 순수 threading + 콜백 방식.
- Discord 다크모드 유지.
- 트레이 통합: `withdraw()` / `deiconify()` — tkinter 네이티브.

## [2026-02-10] 다크 네이비 + 인디고/퍼플 테마
- Discord 다크 → **다크 네이비** 배경 전환 (레퍼런스 UI 기반).
- 밝은 남색 (인디고 `#5B6EF5`) + 보라색 (`#8B5CF6`) 이중 액센트.
- 시작 버튼: 퍼플, 중지 버튼: 인디고 테두리.
- 트레이 아이콘도 인디고/퍼플 색상 적용.

## [2026-02-10] 화이트 모드 심플 전환
- 다크 → **화이트 모드** 전면 교체.
- NanumSquareRound 폰트 로딩 제거, 기본 폰트 사용.
- 색상 5종만 사용: 흰(#FFF), 밝은회(#F5F5F5), 회(#999), 진한회(#333), 구분선(#E0E0E0).
- `ui/app.py`: 전면 재작성 (심플 화이트 UI).

## [2026-02-10] 검색 인터페이스 최적화
- 메뉴 이름 변경: **차량알림** → **검색**.
- 버튼 통합: '시작'과 '중지' 버튼을 하나의 **토글 버튼**으로 통합.
- 상태 메시지 업데이트: 
    - 시작 시: "차량검색을 시작했습니다!"
    - 중단 시: "차량검색을 멈췄습니다!"
- UI 모듈 파라미터 최적화 및 불필요한 임포트 제거.

## [2026-02-10] 차량 상세 카드 프리미엄 디자인 및 컬러 이미지 연동
- **레이아웃 전면 개편:** 그리드 시스템을 도입하여 정보 정렬 및 시각적 균형 최적화.
- **컬러 칩 연동:** `assets/colors` 폴더의 이미지를 자동으로 찾아 외장/내장 색상 옆에 표시.
- **폰트 및 스타일 상향:** 전반적인 글자 크기 확대 및 성공(초록)/할인(빨강) 강조 색상 적용.
- **정보 가독성:** 출고센터, 가격, 할인 정보를 섹션별로 분리하여 한눈에 들어오도록 개선.

## [2026-02-10] 토스트 알림 메시지 간소화
- "대상: 테스트" 제거, 옵션 표시를 이름 나열 → **총 N개** 카운트 방식으로 변경.
- 알림 제목 통일: "🎉 새로운 차량 발견!".
- 알림 높이 130px 확대, 표시 시간 2.5초로 연장.

## [2026-02-10] 알림 클릭 포커싱 및 하이라이트
- **`show_notification`** 함수에 `command` 인자 추가 (클릭 시 액션 지원).
- 알림 클릭 시 **차량검색 탭 자동 전환 + 해당 카드 1.5초 노란색 하이라이트**.
- `VehicleCard` 클래스화 및 `highlight()` 메서드 구현.
- `vehicle_widget_map` (car_id → widget) 매핑으로 즉시 위젯 참조 가능.

## [2026-02-10] 총 발견 대수 실시간 표시
- 상단 바 시작 버튼 옆에 **"총 X대를 찾았습니다"** 라벨 추가.
- 새 차량 발견 시 실시간 갱신.

## [2026-02-10] 해상도 및 레이아웃 최적화
- **최종 해상도**: 960×640 고정 (리사이즈 비활성화).
- 순번(Index) 표시 기능 추가 후 최종적으로 제거 (사용자 피드백 반영).
- 필터 드롭다운 너비 최적화 (트림 80, 옵션 100, 색상 110).

## [2026-02-10] 옵션 복수 선택 (Multi-Select) 기능
- 옵션 필터를 **리스트 기반**으로 전환 (단일 선택 → 복수 선택).
- 토글(Toggle) 방식: 같은 옵션 재클릭 시 해제.
- 선택 상태 시각 피드백: 항목 앞에 **`v `** 체크 표시.
- 콤보박스 요약 표시: `옵션명 외 N개` 형태.
- 우선순위 점수: 선택된 모든 옵션이 포함된 차량일수록 높은 점수 (AND 조건).

## [2026-02-10] 필터 데이터 전수 수집
- **실제 수집 데이터**에서 옵션/색상/트림 리스트를 동적으로 추출하여 누락 방지.
- 기본 목록 + 수집 데이터 병합 방식으로 드롭다운 구성.
- 외장색상/내장색상 목록도 실제 데이터 기반 확대 (비자림 카키, 블랙(인조가죽) 등 추가).

## [2026-02-10] 메타 문서 전면 갱신
- `README.md`: 크롬 익스텐션 → Python 데스크톱 앱으로 전면 재작성.
- `SPEC.md`: 아키텍처/데이터플로우/필터/API 현행화.
- `MAP.md`: 실제 디렉토리 트리와 일치하도록 components/, dummy.py 반영.
- `TODO.md`: 완료 항목 체크 및 미착수 항목 최신화.
- `OPS.md`: 환경 스냅샷 Python/CustomTkinter 기반으로 갱신.
- `STYLE.md`: 코드 규칙 Python PEP 8 기반으로 갱신.
- `UIUX.md`: 화이트 모드 디자인 DNA, 카드 구조, 인터랙션 상세 반영.

## [2026-02-10] 프로젝트 & 소스 전수 분석 및 문서 보정
- 전체 소스 17개 파일(~1,850줄) 분석 완료.
- `MAP.md`: 누락된 `ui/components/toast.py` 항목 추가.
- `OPS.md`: 누락된 `plyer` 의존성 항목 추가.

## [2026-02-10] 개선사항 적용
- **해상도 복원**: 960×640 → 800×400으로 변경 (이전 세션 설정 복원).
- **하드코딩 경로 제거**: `vehicle_card.py`의 절대 경로 → `BASE_DIR` 기반으로 교체.
- **모듈 분할**: `app.py`(512줄) → 필터/정렬 로직을 `ui/filter_logic.py`(~170줄)로 분리, `app.py` ~350줄로 축소.
- 메타 문서 동기화: `README.md`, `OPS.md`, `SPEC.md` 해상도, `MAP.md`에 `filter_logic.py` 추가.

## [2026-02-10] 캐스퍼 일렉트릭 전용 데이터 일치
- **필터 기본값 전면 교체** (`filter_logic.py`):
  - 트림: 스마트/에센셜/모던 제거 → **프리미엄/인스퍼레이션/크로스** 3종.
  - 외장: 11종 (유광 8 + 무광 3), 사양 문서 + 에셋 파일명 기준.
  - 내장: 4종, 에셋 파일명과 정확히 일치.
  - 옵션: 10종, 사양 문서(CASPER_ELECTRIC_2026.md) 기준.
- **더미 데이터 전면 교체** (`dummy.py`):
  - 모델명: `캐스퍼 일렉트릭` 고정 (가솔린 `캐스퍼`, `캐스퍼 밴` 제거).
  - 트림별 가격 범위 반영 (프리미엄 2,936만~, 크로스 3,515만~).
- **색상 매핑 확장** (`vehicle_card.py`):
  - API 응답명 → 에셋 파일명 변환 17건 (소울트로닉 오렌지→시에나 오렌지, 블랙(직물)→블랙 인조가죽 등).
- **가솔린 필터링** (`poller.py`):
  - `_is_electric()` 함수 추가: carCode/carEngineCode/modelNm 기반 가솔린 차량 제외.

## [2026-02-10] 옵션 데이터 홈페이지 대조 보정
- **누락 옵션 추가**: `실내 컬러 패키지`(뉴트로 베이지), `비쥬마린 블루 펄 익스테리어`(인스퍼레이션 전용) — 총 12종.
- **2026형 기본화 주석**: `하이패스`, `현대 스마트센스 I`는 인스퍼레이션/크로스에서 기본 포함.
- **사양 문서 동기화**: `CASPER_ELECTRIC_2026.md`에 `실내 컬러 패키지` 추가, 투톤 루프 별칭, 기본화 주석 반영.
- 잘못된 옵션 삭제: `17인치 알로이 휠 & 타이어`, `비쥬마린 블루 펄 익스테리어` 제거 → 최종 10종.

## [2026-02-10] 해상도 변경 + 전반 성능 최적화
- **해상도**: 800×400 → **1024×720**으로 변경.
- **치명 버그 수정**: `app.py` `_on_notification`에서 미정의 `sort_reverse` 참조 → 이중 리빌드 발생. 디바운싱 1회 리빌드로 교체.
- **History I/O 디바운싱**: 매 알림마다 `load/save_history` → 500ms 디바운싱 배치 저장.
- **핫패스 import 제거**: `_on_notification` 내부 `from core.formatter ...` → 모듈 레벨 import.
- **디렉토리 캐시**: `vehicle_card.py`의 `os.listdir()` fallback → `_dir_cache`로 1회 캐싱.
- **알림 안전성**: `notifier.py`에서 stale reference 방지 (클로저 캡처 + `winfo_exists()` 체크).
- **리빌드 디바운스 간격**: 100ms → 150ms로 조정.

## [2026-02-10] UI 프레임워크 유지 결정
- **Flet 도입 철회**: 테스트용 `ui_flet` 디렉토리 및 관련 파일 일체 삭제.
- **기존 소스 유지**: CustomTkinter 기반의 `ui/` 소스를 계속 개발하기로 결정.
- **성능 최적화 집중**: 앞서 수행한 디바운싱, 캐싱 등 성능 개선 사항을 바탕으로 기존 GUI 안정화에 집중.

## [2026-02-10] 기획전별 지역 설정 기능 추가
- **지역 코드 기반 구축**: `constants/regions.json` 데이터를 활용하여 전국 배송지 및 전기차 보조금 지역 매핑.
- **조건설정(Filter) 탭 구현**: 
    - 기획전별(특별기획전, 전시차 등)로 독립적인 배송지/보조금 지역 설정 UI 추가.
    - 시/도 선택 시 하위 시/군/구 목록이 동적으로 변경되는 콤보박스 구현.
- **API 연동 최적화**:
    - `core/api.py`: 기획전별 지역 코드 오버라이드를 지원하도록 페이로드 빌더 개선.
    - `core/poller.py`: 매 폴링 주기마다 `config.json`을 새로 로드하여 GUI에서의 설정 변경이 즉시 반영되도록 수정.
- **문서 동기화**: `docs/REGIONS.md` 분석 내용을 바탕으로 `config.json` 구조 확장 및 반영.

## [2026-02-10] 조건설정 UI 레이아웃 및 심미성 개선
- **미니멀 디자인 적용**: 기획전 헤더에서 이모지(📌) 및 식별 코드(D0003 등)를 제거하여 깔끔한 레이아웃 구현.
- **여백 기반 가독성 확보**: 인위적인 구분선을 제거하고 섹션 간 세로 간격을 조정하여 자연스러운 영역 구분 유도.
- **저장 버튼 재배치**: 각 기획전 카드 내부 우측 중앙에 "설정 저장" 버튼을 배치하여 인터랙션 일관성 강화.
- **컴포넌트 폴리싱**: 카드 모서리 반경을 12로 조정하여 부드러운 UI 톤앤매너 유지.

## [2026-02-10] 조건설정 UI 레이아웃 및 심미성 개선
- **미니멀 디자인 적용**: 기획전 헤더에서 이모지(📌) 및 식별 코드(D0003 등)를 제거하여 깔끔한 레이아웃 구현.
- **여백 기반 가독성 확보**: 인위적인 구분선을 제거하고 섹션 간 세로 간격을 조정하여 자연스러운 영역 구분 유도.
- **저장 버튼 재배치**: 각 기획전 카드 내부 우측 중앙에 "설정 저장" 버튼을 배치하여 인터랙션 일관성 강화.
- **부정확한 치환 제거**: 에셋이 존재하지 않는 경로로 리다이렉트되던 일부 매핑을 현실적인 유사 색상으로 재매핑.

## [2026-02-10] 단종 색상 데이터 정리
- **색상 단종 반영**: 현재 생산되지 않는 "비자림 카키" 관련 모든 매핑 로직을 `vehicle_card.py`에서 삭제함.
- **매핑 최적화**: API 응답에서 발생할 수 있는 레거시 데이터 간섭을 최소화하기 위해 에셋과 1:1 대응되는 최신 컬러칩 위주로 매핑 구성.

## [2026-02-10] 사용자 편의 기능 추가
- **종료 버튼 구현**: 왼쪽 네비게이션 메뉴 하단에 전용 "종료" 버튼 배치.
- **안전한 종료 절차**: 종료 버튼 클릭 시 `tkinter.messagebox`를 호출하여 "종료하시겠습니까?" 컨펌 다이얼로그 노출. "예" 선택 시 폴링 엔진 정지 및 앱 안전 종료 프로세스 수행.

## [2026-02-10] 앱 부팅 및 시작 옵션 추가
- **윈도우 자동 실행**: 설정 메뉴에 "윈도우 시작 시 자동 실행" 토글 추가. 윈도우 레지스트리(`HKCU\...\Run`)와 연동하여 부팅 시 프로그램 자동 실행 제어.
- **트레이로 시작**: 설정 메뉴에 "프로그램 시작 시 트레이로 시작" 토글 추가. 프로그램 실행 직후 메인 윈도우를 숨기고 시스템 트레이에서 백그라운드 작동을 시작하도록 구현.
- **백앤드 유틸리티**: 윈도우 전용 Registry API(`winreg`)를 사용하는 `core/utils.py` 모듈 신규 도입.

## [2026-02-10] 앱 상태 유지 및 UI 정교화
- **마지막 작업 기억**: 앱 종료 시 현재 창 위치/크기(Geometry) 및 활성화된 탭 인덱스를 `config.json`에 자동 저장하고, 재시작 시 이를 완벽히 복구함.
- **정중앙 다이얼로그**: 부모 윈도우의 좌표를 실시간 계산하여 항상 앱 화면 정중앙에 노출되는 커스텀 `CenteredConfirmDialog` 도입.
- **UX 일관성**: 기존 `messagebox`를 제거하고 테마와 일치하는 디자인의 다이얼로그를 통해 인터랙션 품질 향상.

## [2026-02-10] PyInstaller를 통한 EXE 배포판 생성
- **빌드 환경 구축**: `pyinstaller` 설치 및 CustomTkinter 테마/폰트 최적화 구성을 포함한 `CasperFinder.spec` 파일 작성.
- **리소스 패키징**: `assets`, `constants` 폴더와 `customtkinter` 내부 데이터셋을 빌드 경로에 포함하여 독립 실행 가능하도록 구성.
- **결과물**: `dist/CasperFinder` 경로에 윈도우 실행 파일(`CasperFinder.exe`) 생성 완료. 콘솔 창이 뜨지 않는 GUI 전용 모드 적용.

## [2026-02-10] 사용자 경험(UX) 고도화 및 브랜딩 정교화
- **사이드바 여백 확보**: 사이드바 상단의 로고와 텍스트를 제거하여 더욱 미니멀하고 시원한 레이아웃 구현.
- **스플래시 스크린 도입**: 앱 시작 시 캐스퍼 일렉트릭 고화질 이미지(`assets/splash.png`)를 화면 중앙에 띄워 로딩 시각화 및 프리미엄 경험 제공.
## [2026-02-11] v0.0.1: 알림 사운드 및 안정화
- **알림 사운드 연동**: 차량 발견 시 Windows MCI API(무설치) 기반 MP3 재생 기능 추가.
- **설정 항목 추가**: 설정 탭 내 `사운드 알림 활성화` 및 `볼륨 슬라이더` 구현.
- **이미지 최적화**: 색상 칩 이미지 리사이징 및 캐싱 로직 강화.

## [2026-02-11] v0.0.2: 성능 최적화 및 UX 고도화
- **위젯 풀(Widget Pool) 도입**: 카드 위젯을 파괴/재생성하지 않고 재사용하여 메모리 및 CPU 사용량 획기적 절감.
- **증분 렌더링(Incremental Append)**: 새 차량 발견 시 해당 카드만 리스트 맨 앞에 즉시 추가 (O(n) -> O(1)).
- **스무스(관성) 스크롤**: `SmoothScrollFrame` 클래스 도입으로 부드러운 스크롤 감도 구현 (CTkScrollableFrame 오버라이드).
- **필터링 로직 강화**: '정렬' 위주에서 '정확한 필터링'으로 전환. 매칭되지 않는 차량은 리스트에서 자동 숨김.
- **옵션 복수 선택 개선**: 체크마크(`✓`) 가시성 향상 및 콤보박스 인라인 상태 갱신(`옵션명 외 N개`).
- **업데이트 알림 시스템**:
    - `3일 후에 다시 알림` 기능 추가 (config `updateDismissUntil` 연동).
    - 설정 페이지 내 인라인 `다운로드 및 설치` 버튼 구현.
- **자동 빌드 및 배포**:
    - PyInstaller (`CasperFinder.spec`) 및 Inno Setup (`installer.iss`) 연동 v0.0.2 빌드.
    - GitHub 리포지토리 동기화.

## [2026-02-11] v0.0.3: 배포 안정화 및 알림 강화
- **완전한 제거(Uninstall) 로직**:
    - 제거 시 실행 중인 `CasperFinder.exe` 자동 종료.
    - `%LOCALAPPDATA%\CasperFinder` (사용자 설정/데이터) 완전 삭제.
    - 윈도우 시작 프로그램 레지스트리 키 자동 정리.
- **알림 뱃지 시스템 (4중 알림)**:
    - **타이틀바**: 새 차량 대수 실시간 표시 (`🔔 N대 새 차량!`).
    - **사이드바 메뉴**: 차량검색 메뉴 옆 빨간 숫자 뱃지 추가.
    - **트레이 아이콘**: 마우스 호버 시 상세 대수 툴팁 표시.
    - **작업표시줄**: 새 차량 발견 시 아이콘 깜박임(Flash) 효과.
- **사용자 설정 추가**:
    - `프로그램 시작 시 바로 차량검색` 옵션 추가 (On/Off 가능).
- **문서화**: `docs/DEPLOY.md` 리소스를 활용한 빌드/배포 가이드 작성.

## [2026-02-11] v0.0.5: 설치 안정성 및 테스트 유틸 고도화
- **설치/업데이트 오류 해결**:
    - PyInstaller onefile 모드 특유의 `python310.dll` 로드 실패(Failed to load Python DLL) 문제 해결.
    - 인스톨러(`PrepareToInstall`) 단계에서 기존 빌드의 `%TEMP%/_MEI*` 임시 폴더를 자동 정리하는 로직 추가.
- **테스트 유틸리티 완성**:
    - 더미 데이터 **[지우기]** 버튼 추가 (차량 데이터 및 위젯 전체 초기화).
    - 이스터에그 기능으로 테스트 버튼들을 숨김 처리하여 일반 사용자와 개발자 환경 분리.
- **코드 안정성**: 뱃지 카운트 및 작업표시줄 깜박임(FlashWindowEx) 로직의 예외 처리 강화.

## [2026-02-11] v0.0.6: 트림 복수선택 · 폴링 고속화 · 자동 계약
- **트림 복수선택**: 트림 필터를 옵션과 동일한 복수선택(토글) 방식으로 변경.
- **폴링 간격 3초 + 랜덤 지터**: 5초 → 3초 기반 + 0~0.99초 랜덤 지터 (3.00~3.99초). 봇 패턴 감지 회피.
- **자동 계약 페이지 열기**: 설정에서 `필터 조건 일치 시 자동으로 계약 페이지 열기` 체크 시, 필터 완전 일치 차량 발견 → 브라우저 자동 오픈.
- **필터 콤보박스 간격 조정**: 트림/옵션/외장/내장 간 좌우 여백 확대.
- **DLL 로드 실패 근본 해결**: `runtime_tmpdir='.'` 적용으로 `%TEMP%` 대신 앱 폴더에 추출.
